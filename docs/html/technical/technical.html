

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>945 Technical Manual &mdash; 945 Manuals  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="&gt; Thai Tax Report" href="../functional/th_tax_report.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> 945 Manuals
          

          
          </a>

          
            
            
              <div class="version">
                13.0.1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../functional/overview.html">945 Functional Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/auto_workflow.html">&gt; Automatic Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/deferred_revenue.html">&gt; Deferred Revenue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/manual_payment.html">&gt; Manual Payment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/th_tax_report.html">&gt; Thai Tax Report</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">945 Technical Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#development-concept">945 Development Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="#odoo-oca-945">Odoo + OCA + 945</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#modules">&gt; Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#oca-modules">OCA Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">945 Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#apis">&gt; 945 APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ecommerce">eCommerce</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ecommerce-standard">eCommerce - Standard</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ecommerce-consignment-fix-gp">eCommerce - Consignment Fix GP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ecommerce-consignment-var-gp">eCommerce - Consignment Var GP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#express">Express</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#express-standard">Express - Standard</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#job-queue">&gt; Job Queue</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id5">Job Queue คืออะไร</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">ข้อดีของ Job Queue</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configurations">Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#sale-automatic-workflow">&gt; Sale Automatic Workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id8">Sale Automatic Workflow คืออะไร</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">Configurations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#order-configuration">Order Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#workflow-options">Workflow Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">945 Workflow Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#s-configurations">945’s Configurations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">eCommerce Standard</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">eCommerce Consignment Fix GP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">eCommerce Consignment Var GP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">Express Standard</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#account-move-template">&gt; Account Move Template</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id16">Account Move Template คืออะไร</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id17">Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id18">วิธีใช้ Account Move Template</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#code">1. เรียกใช้งานผ่าน Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ui">2. เรียกใช้งานผ่าน UI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#compute-helper">&gt; Compute helper</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id20">Compute Helper คืออะไร</a></li>
<li class="toctree-l2"><a class="reference internal" href="#server-actions">Server Actions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#unit-test">&gt; Unit Test</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-unit-test">What is unit test?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id22">การเขียน Unit Test</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">945 Manuals</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>945 Technical Manual</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/technical/technical.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="technical-manual">
<h1>945 Technical Manual<a class="headerlink" href="#technical-manual" title="Permalink to this headline">¶</a></h1>
<div class="section" id="development-concept">
<h2>945 Development Concept<a class="headerlink" href="#development-concept" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>ออกแบบระบบโดยเน้นการคงการทำงานด้านบัญชีตามมาตรฐาน Odoo ให้มากที่สุดโดยอิงหลักการ <a class="reference internal" href="#odoo-oca-custom"><span class="std std-ref">Odoo + OCA + Custom</span></a></p></li>
<li><p>ส่วนโมดูลเพิ่มเติม เน้นการใช้งาน OCA modules ก่อนหลังจากนั้นจึงใช้ Customer Codes ดูคำบรรยายของแต่ละโมดูลเสริมได้จาก <a class="reference internal" href="#modules"><span class="std std-ref">Modulesx</span></a></p></li>
<li><p>การยิง API มีการยิงเข้า 2 จุดหลัก คือเข้าที่หน้าต่าง Sales Order และเข้าที่หน้าต่าง 945 Operations โดยการยิง Reference API สามารถดูได้ที่ <a class="reference internal" href="#apis"><span class="std std-ref">APIs</span></a></p></li>
<li><p>การยิง API เข้ามาในระบบจะเป็นการยิงเข้า <a class="reference internal" href="#job-queue"><span class="std std-ref">Job Queue</span></a> เสมอเพื่อให้ระบบมีความเร็วและรับโหลดได้มาก</p></li>
</ul>
<ul class="simple">
<li><p>กรณียิง API เข้า Sales Order ในบางประเภทจะมีการ Compute Action เพื่อทำการปรับปรุงรายการให้เข้ากับแบบแผนการคำนวนของ 945
และใช้ <a class="reference internal" href="#sale-automatic-workflow"><span class="std std-ref">Sale Automatic Workflow</span></a> เพื่อทำการวิ่งเอกสารต่อไปยัง Account Invoice เพื่อทำการบันทึกบัญชี (ตามหลัก Odoo ปกติ)</p></li>
<li><p>กรณียิง API เข้า 945 Operations (ซึ่งมีหลาย windows/model ในการรับข้อมูล) จะมีการสร้าง Journal ด้วย <a class="reference internal" href="#account-move-template"><span class="std std-ref">Account Move Template</span></a></p></li>
<li><p>ในกรณีมีการคำนวนที่่มีความซับซ้อน ระบบจะเรียกใช้งาน <a class="reference internal" href="#compute-helper"><span class="std std-ref">Compute Helper</span></a></p></li>
<li><p>มี <a class="reference internal" href="#unit-test"><span class="std std-ref">Unit Test</span></a> สำหรับ process ที่สำคัญ</p></li>
</ul>
</div>
<div class="section" id="odoo-oca-945">
<span id="odoo-oca-custom"></span><h2>Odoo + OCA + 945<a class="headerlink" href="#odoo-oca-945" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Odoo Core</p></li>
<li><p>Odoo Enterprise version 13</p></li>
<li><p><strong>Odoo Community Association (OCA)</strong></p></li>
<li><p><strong>Customer Codes (945)</strong></p></li>
</ol>
<img alt="../_images/eco.png" class="align-center" src="../_images/eco.png" />
</div>
</div>
<div class="section" id="modules">
<span id="id1"></span><h1>&gt; Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h1>
<div class="section" id="oca-modules">
<h2>OCA Modules<a class="headerlink" href="#oca-modules" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>l10n_th_xxx (โมดูลที่เริ่มต้นด้วย)</dt><dd><p>เกี่ยวกับภาษีไทย - WHT, VAT, Undue VAT, Tax Reports.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>account_mass_reconcile, account_mass_reconcile_helper</dt><dd><p>โมดูลเสริมเพื่อให้ผู้ใช้งานทางบัญชีสามารถจับคู่เคลียร์ได้่ง่ายขึ้น โดยตั้งค่าการเคลียร์แบบอัตโนมัติได้</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>account_move_template</dt><dd><p>ช่วยในการสร้าง Template สำหรับการบันทึกบัญชี เรียกใช้โดย Operations ต่างๆ</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>account_payment_term_extension</dt><dd><p>เพิ่ม Payment Term ตามโจทย์ของ 945 เช่นเอกสารในอาทิตย์นี้ทั้งหมดให้ไปกองวันครบกำหนดที่ศูกร์หน้า เป็นต้น</p>
</dd>
</dl>
</li>
</ul>
<ul class="simple">
<li><dl class="simple">
<dt>queue_job</dt><dd><p>Base module สำหรับ Queue Job ถูกเรียกใช้โดย sunteen_api ในการเปลี่ยน function ให้เป็นแบบ queue <code class="code docutils literal notranslate"><span class="pre">&#64;job_auto_delay</span></code></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sale_automatic_workflow, sale_automatic_workflow_job</dt><dd><p>โมดูลเสริมเพื่อให้ workflow จาก Sales Order -&gt; Invoice เกิดขึ้นโดยอัตโนมัติ</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>base_import_async</dt><dd><p>โมดูลเสริมเพื่อให้สามารถ import ไฟล์ csv เป็นเบื้องหลังได้ ทำให้สามารถทำงานที่เกี่ยวข้องกับการ import ได้รวดเร็วยิ่งขึ้น</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bi_sql_editor</dt><dd><p>โมดูลที่ช่วยในการ query ข้อมมูลจาก database ผ่าน UI</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2>945 Modules<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>sunteen</dt><dd><p>โมดูลหลักสำหรับ Business Process ของ 945 ทั้งหมด เช่น eCommerce, Express.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sunteen_api</dt><dd><p>ทำหน้าที่ interface ระหว่างระบบ Odoo กับระบบอื่นๆ</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sunteen_bi_sql, sunteen_coa, sunteen_data, sunteen_form, sunteen_bi_sql</dt><dd><p>ทำหน้าที่โหลดข้อมูลที่ต้องใช้งาน เช่น Chart of Account, Move Templates, การตั้งค่าต่างๆ และแบบฟอร์ม</p>
</dd>
</dl>
</li>
</ul>
<ul class="simple">
<li><dl class="simple">
<dt>sunteen_install</dt><dd><p>ทำหน้าที่่เรียกการติดตั้งโมดูลทั่งหมดที่ต้องใช้ใน 945 โดยตัวเองไม่ได้มี logic ใดๆ</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sunteen_mass_reconcile</dt><dd><p>เสริมการทำงานของ account_mass_reconcile เพื่อให้จับคู่เคลียร์ผ่าน Parcel Number ได้</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sunteen_test</dt><dd><p>โมดูลเสริมสำหรับการทำ Unit Test</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="apis">
<span id="id3"></span><h1>&gt; 945 APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h1>
<p>ตัวอย่างการใช้งาน APIs ระบบ 945</p>
<div class="section" id="ecommerce">
<h2>eCommerce<a class="headerlink" href="#ecommerce" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>eCommerce - Standard</p></li>
<li><p>eCommerce - Consignment Fix GP</p></li>
<li><p>eCommerce - Consignment VAR GP</p></li>
</ul>
<div class="section" id="ecommerce-standard">
<h3>eCommerce - Standard<a class="headerlink" href="#ecommerce-standard" title="Permalink to this headline">¶</a></h3>
<p>API 1 (sale.order)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;out of delivery&quot;</span><span class="p">,</span>  <span class="c1"># Status: out of delivery</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Customer (res.partner)</span>
        <span class="s2">&quot;sunteen_dealer_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Dealer (res.partner)</span>
        <span class="s2">&quot;workflow_process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;eCommerce Standard&quot;</span><span class="p">,</span>  <span class="c1"># Automatic Workflow (sale.workflow.process)</span>
        <span class="s2">&quot;date_order&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-01-31&quot;</span><span class="p">,</span>  <span class="c1"># Order Date</span>
        <span class="s2">&quot;transaction_date&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Transaction Date</span>
        <span class="s2">&quot;sunteen_payment_method_id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Payment Method (sunteen.payment.method)</span>
        <span class="s2">&quot;sunteen_payment_provider_id&quot;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span>  <span class="c1"># Payment Provider (res.partner)</span>
        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>  <span class="c1"># Total</span>
        <span class="s2">&quot;order_line&quot;</span><span class="p">:</span> <span class="p">[</span>  <span class="c1"># Sale Order Line</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Parcel Number</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>  <span class="c1"># Transporter (res.partner)</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>  <span class="c1"># Customer</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>  <span class="c1"># Product (product.product)</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Quantity</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Dealer Unit Price</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Dealer Amount Difference Line</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">20.0</span><span class="p">,</span>  <span class="c1"># API sent +, odoo change to -</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;auto_create&quot;</span><span class="p">:</span> <span class="p">{</span>    <span class="c1"># Optional for auto create master data</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Customer 1&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Product 1&quot;</span><span class="p">,</span> <span class="s2">&quot;default_code&quot;</span><span class="p">:</span> <span class="s2">&quot;PRODUCT1&quot;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>API2 (sunteen.delivery.complete):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>  <span class="c1"># Status : completed/return</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Customer (res.partner)</span>
        <span class="s2">&quot;sunteen_dealer_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Dealer (res.partner)</span>
        <span class="s2">&quot;workflow_process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;eCommerce Standard&quot;</span><span class="p">,</span>  <span class="c1"># Automatic Workflow (sale.workflow.process)</span>
        <span class="s2">&quot;date_order&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-01-31&quot;</span><span class="p">,</span>  <span class="c1"># Order Date</span>
        <span class="s2">&quot;transaction_date&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Transaction Date</span>
        <span class="s2">&quot;sunteen_payment_method_id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Payment Method (sunteen.payment.method)</span>
        <span class="s2">&quot;sunteen_payment_provider_id&quot;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span>  <span class="c1"># Payment Provider (res.partner)</span>
        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>  <span class="c1"># Total</span>
        <span class="s2">&quot;order_line&quot;</span><span class="p">:</span> <span class="p">[</span>  <span class="c1"># Sale Order Line</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Parcel Number</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>  <span class="c1"># Transporter (res.partner)</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>  <span class="c1"># Customer</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>  <span class="c1"># Product (product.product)</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Quantity</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Dealer Unit Price</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Dealer Amount Difference Line</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">20.0</span><span class="p">,</span>  <span class="c1"># API sent +, odoo change to -</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;auto_create&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Optional for auto create master data</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Customer 1&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Product 1&quot;</span><span class="p">,</span> <span class="s2">&quot;default_code&quot;</span><span class="p">:</span> <span class="s2">&quot;PRODUCT1&quot;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ecommerce-consignment-fix-gp">
<h3>eCommerce - Consignment Fix GP<a class="headerlink" href="#ecommerce-consignment-fix-gp" title="Permalink to this headline">¶</a></h3>
<p>API1 (sunteen.record.transportation.cost):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;out of delivery&quot;</span><span class="p">,</span>  <span class="c1"># Status: out of delivery</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Customer=Consignor (res.partner)</span>
        <span class="s2">&quot;sunteen_dealer_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Dealer (res.partner)</span>
        <span class="s2">&quot;workflow_process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;eCommerce Consignment Fix GP&quot;</span><span class="p">,</span>  <span class="c1"># Automatic Workflow (sale.workflow.process)</span>
        <span class="s2">&quot;date_order&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-01-31&quot;</span><span class="p">,</span>  <span class="c1"># Order Date</span>
        <span class="s2">&quot;transaction_date&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Transaction Date</span>
        <span class="s2">&quot;sunteen_payment_method_id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Payment Method (sunteen.payment.method)</span>
        <span class="s2">&quot;sunteen_payment_provider_id&quot;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span>  <span class="c1"># Payment Provider (res.partner)</span>
        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>  <span class="c1"># Total</span>
        <span class="s2">&quot;order_line&quot;</span><span class="p">:</span> <span class="p">[</span>  <span class="c1"># Sale Order Line</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Parcel Number</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>  <span class="c1"># Transporter (res.partner)</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>  <span class="c1"># Customer</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>  <span class="c1"># Product (product.product)</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Quantity</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Dealer Unit Price</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Dealer Amount Difference Line</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">20.0</span><span class="p">,</span>  <span class="c1"># API sent +, odoo change to -</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;auto_create&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Optional for auto create master data</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Customer 1&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Product 1&quot;</span><span class="p">,</span> <span class="s2">&quot;default_code&quot;</span><span class="p">:</span> <span class="s2">&quot;PRODUCT1&quot;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>API2 (sale.order):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>  <span class="c1"># Status: completed/return</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Customer=Consignor (res.partner)</span>
        <span class="s2">&quot;sunteen_dealer_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Dealer (res.partner)</span>
        <span class="s2">&quot;workflow_process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;eCommerce Consignment Fix GP&quot;</span><span class="p">,</span>  <span class="c1"># Automatic Workflow (sale.workflow.process)</span>
        <span class="s2">&quot;date_order&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-01-31&quot;</span><span class="p">,</span>  <span class="c1"># Order Date</span>
        <span class="s2">&quot;transaction_date&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Transaction Date</span>
        <span class="s2">&quot;sunteen_payment_method_id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Payment Method (sunteen.payment.method)</span>
        <span class="s2">&quot;sunteen_payment_provider_id&quot;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span>  <span class="c1"># Payment Provider (res.partner)</span>
        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>  <span class="c1"># Total</span>
        <span class="s2">&quot;order_line&quot;</span><span class="p">:</span> <span class="p">[</span>  <span class="c1"># Sale Order Line</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Parcel Number</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>  <span class="c1"># Transporter (res.partner)</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>  <span class="c1"># Customer</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>  <span class="c1"># Product (product.product)</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Quantity</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Dealer Unit Price</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Dealer Amount Difference Line</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">20.0</span><span class="p">,</span>  <span class="c1"># API sent +, odoo change to -</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;auto_create&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Optional for auto create master data</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Customer 1&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Product 1&quot;</span><span class="p">,</span> <span class="s2">&quot;default_code&quot;</span><span class="p">:</span> <span class="s2">&quot;PRODUCT1&quot;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ecommerce-consignment-var-gp">
<h3>eCommerce - Consignment Var GP<a class="headerlink" href="#ecommerce-consignment-var-gp" title="Permalink to this headline">¶</a></h3>
<p>API1 (sunteen.record.transportation.cost):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;out of delivery&quot;</span><span class="p">,</span>  <span class="c1"># Status: out of delivery</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Customer=Consignor (res.partner)</span>
        <span class="s2">&quot;sunteen_dealer_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Dealer (res.partner)</span>
        <span class="s2">&quot;workflow_process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;eCommerce Consignment Var GP&quot;</span><span class="p">,</span>  <span class="c1"># Automatic Workflow (sale.workflow.process)</span>
        <span class="s2">&quot;date_order&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-01-31&quot;</span><span class="p">,</span>  <span class="c1"># Order Date</span>
        <span class="s2">&quot;transaction_date&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Transaction Date</span>
        <span class="s2">&quot;sunteen_payment_method_id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Payment Method (sunteen.payment.method)</span>
        <span class="s2">&quot;sunteen_payment_provider_id&quot;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span>  <span class="c1"># Payment Provider (res.partner)</span>
        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>  <span class="c1"># Total</span>
        <span class="s2">&quot;order_line&quot;</span><span class="p">:</span> <span class="p">[</span>  <span class="c1"># Sale Order Line</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Parcel Number</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>  <span class="c1"># Transporter (res.partner)</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>  <span class="c1"># Customer</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>  <span class="c1"># Product (product.product)</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Quantity</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Dealer Unit Price</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Dealer Amount Difference Line</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">20.0</span><span class="p">,</span>  <span class="c1"># API sent +, odoo change to -</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;auto_create&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Optional for auto create master data</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Customer 1&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Product 1&quot;</span><span class="p">,</span> <span class="s2">&quot;default_code&quot;</span><span class="p">:</span> <span class="s2">&quot;PRODUCT1&quot;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>API2 (sale.order):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>  <span class="c1"># Status: completed/return</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Customer=Consignor (res.partner)</span>
        <span class="s2">&quot;sunteen_dealer_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Dealer (res.partner)</span>
        <span class="s2">&quot;workflow_process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;eCommerce Consignment Var GP&quot;</span><span class="p">,</span>  <span class="c1"># Automatic Workflow (sale.workflow.process)</span>
        <span class="s2">&quot;date_order&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-01-31&quot;</span><span class="p">,</span>  <span class="c1"># Order Date</span>
        <span class="s2">&quot;transaction_date&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Transaction Date</span>
        <span class="s2">&quot;sunteen_payment_method_id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Payment Method (sunteen.payment.method)</span>
        <span class="s2">&quot;sunteen_payment_provider_id&quot;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span>  <span class="c1"># Payment Provider (res.partner)</span>
        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>  <span class="c1"># Total</span>

        <span class="s2">&quot;order_line&quot;</span><span class="p">:</span> <span class="p">[</span>  <span class="c1"># Sale Order Line</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Parcel Number</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>  <span class="c1"># Transporter (res.partner)</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>  <span class="c1"># Customer</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>  <span class="c1"># Product (product.product)</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Quantity</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Dealer Unit Price</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Dealer Amount Difference Line</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">20.0</span><span class="p">,</span>  <span class="c1"># API sent +, odoo change to -</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;auto_create&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Optional for auto create master data</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Customer 1&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Product 1&quot;</span><span class="p">,</span> <span class="s2">&quot;default_code&quot;</span><span class="p">:</span> <span class="s2">&quot;PRODUCT1&quot;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="express">
<h2>Express<a class="headerlink" href="#express" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Express - Standard</p></li>
</ul>
<div class="section" id="express-standard">
<h3>Express - Standard<a class="headerlink" href="#express-standard" title="Permalink to this headline">¶</a></h3>
<p>API1 (sale.order):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;out of delivery&quot;</span><span class="p">,</span>  <span class="c1"># Status: out of delivery</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Customer (res.partner)</span>
        <span class="s2">&quot;sunteen_merchant_id&quot;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>  <span class="c1"># Merchant (res.partner)</span>
        <span class="s2">&quot;sunteen_merchant_level&quot;</span><span class="p">:</span> <span class="s2">&quot;ecom&quot;</span><span class="p">,</span>  <span class="c1"># Merchant Level: ecom/agent/franchise</span>
        <span class="s2">&quot;sunteen_merchant_ownership&quot;</span><span class="p">:</span> <span class="s2">&quot;my945&quot;</span><span class="p">,</span>  <span class="c1"># Merchant Ownership: my945/others</span>
        <span class="s2">&quot;workflow_process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Express Standard&quot;</span><span class="p">,</span>  <span class="c1"># Automatic Workflow (sale.workflow.process)</span>
        <span class="s2">&quot;date_order&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-01-31&quot;</span><span class="p">,</span>  <span class="c1"># Order Date</span>
        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>  <span class="c1"># Total</span>
        <span class="s2">&quot;order_line&quot;</span><span class="p">:</span> <span class="p">[</span>  <span class="c1"># Sale Order Line</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Parcel Number</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>  <span class="c1"># Transporter (res.partner)</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>  <span class="c1"># Customer</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>  <span class="c1"># Product (product.product)</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Quantity</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Dealer Unit Price</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span>  <span class="c1"># Type: normal, cod</span>
                <span class="s2">&quot;cod_amount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># COD Amount</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ002&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;cod&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cod_amount&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;auto_create&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Optional for auto create master data</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Customer 1&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Product 1&quot;</span><span class="p">,</span> <span class="s2">&quot;default_code&quot;</span><span class="p">:</span> <span class="s2">&quot;PRODUCT1&quot;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>API2 (sunteen.express.delivery.complete):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>  <span class="c1"># Status : completed/return</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Customer (res.partner)</span>
        <span class="s2">&quot;sunteen_merchant_id&quot;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>  <span class="c1"># Merchant (res.partner)</span>
        <span class="s2">&quot;sunteen_merchant_level&quot;</span><span class="p">:</span> <span class="s2">&quot;ecom&quot;</span><span class="p">,</span>  <span class="c1"># Merchant Level: ecom/agent/franchise</span>
        <span class="s2">&quot;sunteen_merchant_ownership&quot;</span><span class="p">:</span> <span class="s2">&quot;my945&quot;</span><span class="p">,</span>  <span class="c1"># Merchant Ownership: my945/others</span>
        <span class="s2">&quot;workflow_process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;Express Standard&quot;</span><span class="p">,</span>  <span class="c1"># Automatic Workflow (sale.workflow.process)</span>
        <span class="s2">&quot;date_order&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-01-31&quot;</span><span class="p">,</span>  <span class="c1"># Order Date</span>
        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>  <span class="c1"># Total</span>
        <span class="s2">&quot;order_line&quot;</span><span class="p">:</span> <span class="p">[</span>  <span class="c1"># Sale Order Line</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ001&quot;</span><span class="p">,</span>  <span class="c1"># Parcel Number</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>  <span class="c1"># Transporter (res.partner)</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>  <span class="c1"># Customer</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>  <span class="c1"># Product (product.product)</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Quantity</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Dealer Unit Price</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span>  <span class="c1"># Type: normal, cod</span>
                <span class="s2">&quot;cod_amount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># COD Amount</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>  <span class="c1"># Status: completed/return</span>
                <span class="s2">&quot;transaction_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-02-02&quot;</span><span class="p">,</span>  <span class="c1"># Transaction Date</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;sunteen_parcel_number&quot;</span><span class="p">:</span> <span class="s2">&quot;TDZ002&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_partner_id&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
                <span class="s2">&quot;sunteen_customer&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
                <span class="s2">&quot;product_uom_qty&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;dealer_price_unit&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;cod&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cod_amount&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>
                <span class="s2">&quot;transaction_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-02-20&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;auto_create&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Optional for auto create master data</span>
        <span class="s2">&quot;partner_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Customer 1&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOMER1&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Product 1&quot;</span><span class="p">,</span> <span class="s2">&quot;default_code&quot;</span><span class="p">:</span> <span class="s2">&quot;PRODUCT1&quot;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>สำหรับ eCommerce การส่งข้อมูลจะเป็น 1 API ต่อ 1 Parcel Number ส่วน Express จะเป็น 1 API ต่อ หลาย Parcel Number</p>
</div>
</div>
</div>
</div>
<div class="section" id="job-queue">
<span id="id4"></span><h1>&gt; Job Queue<a class="headerlink" href="#job-queue" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id5">
<h2>Job Queue คืออะไร<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Job Queue คือการหน่วงการทำงานของ process โดยแทนที่จะทำทันที ก็จะหน่วงและทำในภายหลัง</p>
<p>เช่น หากระบบต้นทางต้องการยิง API เข้ามา 1,000 รายการ ถ้าไม่มี Job Queue ระบบต้นทางจะต้องรอจนกว่ารายการก่อนหน้าจะทำงานเสร็จ
จึงจะยิงรายการถัดมาได้ ถ้า server ไม่สามารถทำงานได้เร็วพอก็จะเกิดปัญหาได้ ถ้าใช้ Job Queue ระบบต้นทางสามารถยิงข้อมูลเข้ามาได้ทั้งหมดอย่างรวดเร็วโดยไม่โหลด server
(เพราะยังไม่เกิดการทำงานจริง)</p>
<p>ข้อมูลการทำงานทั้งหมดจะเข้ามาพักที่ table <code class="code docutils literal notranslate"><span class="pre">queue.job</span></code> ของ Odoo ก่อน แล้วจึงทยอยทำงานพร้อมกันตามจำนวน <strong>workers</strong></p>
<p>ข้อดีอีกประการหนึ่ง จากการที่ข้อมูลการทำงานได้เข้ามาพักไว้ก่อน ไม่ว่าการทำงานจะสำเร็จหรือไม่ ก็จะสามารถตรวจเช็คได้ในภายหลังที่ Odoo</p>
</div>
<div class="section" id="id6">
<h2>ข้อดีของ Job Queue<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>เก็บรายการที่ยิงเข้ามาใน database table queue.job (ตั้งเวลาลบทิ้งได้หลังจากทำงานเสร็จและเวลาผ่านไปนาน)</p></li>
<li><p>Jobrunner: ทำงานกับ queue ที่เข้ามาได้อย่างทันที</p></li>
<li><p>Channels: แบ่งการทำงานของ workers ตาม channel, sub-channel ได้ เพื่อจำกัด worker บางตัวให้ทำงานบางอย่างไม่ปนกัน (ไม่แย่ง CPU)</p></li>
<li><p>Retries: มีการ retry งานที่ failed (บางครั้ง faile เพราะ update รายการเดียวกันพร้อมกัน ซึ่งทำอีกครั้งก็จะผ่านไปได้)</p></li>
<li><p>Retry Pattern: เช่น ให้ retry 3 ครั้งแรกห่างกัน 10 วินาที retry 5 ครั้งต่อไป ทุกๆ 1 นาที</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>สำหรับ 945 เราได้ตั้งค่าการทำงานแบบทั่วๆไป อนาคตสามารถเปลี่ยนแปลงได้ตามความเหมาะสม</p>
</div>
</div>
<div class="section" id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this headline">¶</a></h2>
<p>เพื่อให้ Job Queue ทำงานได้ ต้องมีการตั้งค่าที่ odoo config file.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Using the Odoo configuration file:
<span class="o">[</span>options<span class="o">]</span>
<span class="o">(</span>...<span class="o">)</span>
<span class="nv">workers</span> <span class="o">=</span> <span class="m">6</span>
<span class="nv">server_wide_modules</span> <span class="o">=</span> web,queue_job

<span class="o">(</span>...<span class="o">)</span>
<span class="o">[</span>queue_job<span class="o">]</span>
<span class="nv">channels</span> <span class="o">=</span> root:2
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ตัวอย่างนี้ให้ใช้ worker 2 ตัวจากทั้งหมด 6 ตัว ทำงานกับ channel = root</p>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/job_queue1.png" class="align-center" src="../_images/job_queue1.png" />
<ol class="arabic simple">
<li><p>Job Menu: แต่ละ API ที่ถูกยิงเข้ามาจะเข้ามาสร้าง Job โดยจะเริ่มต้นที่ status = Pending</p></li>
<li><p>Job Status: Pending = รอ, Enqueue = เข้าคิว, Started = เริ่มทำงาน, Done = เสร็จ, Failed = ไม่สำเร็จ</p></li>
<li><p>Task: รายละเอียดของ function call ที่จะทำ โดยมี input data ทั้งหมดที่ต้องใช้</p></li>
<li><p>Function / Channel: Function นี้ทำงานผ่าน Channel ใหน เช่น root.sunteen_api ซึ่งเป็น sub-channel ของ root (จะใช้ร worker ่วมกับ root หากไม่ประกาศแยกไว้)</p></li>
<li><p>Retry: จำนวนครั้งที่ retry</p></li>
<li><p>Result: ผลลัพธ์ที่ได้ หากเกิด Error จะแสดงเป็นข้อความ exception และเปลี่ยนสถานะเป็น status = Failed (และ retry)</p></li>
</ol>
</div>
</div>
<div class="section" id="sale-automatic-workflow">
<span id="id7"></span><h1>&gt; Sale Automatic Workflow<a class="headerlink" href="#sale-automatic-workflow" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id8">
<h2>Sale Automatic Workflow คืออะไร<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p><strong>Menu:</strong> Sales &gt; Configuration &gt; Automatic Workflow &gt; Automatic Workflow</p>
<p>Sale Automatic Workflow คือ กระบวนการการดำเนินงานโดยอัตโนมัติที่เกี่ยวข้องกับการขาย ตัวอย่างกระบวนการการดำเนินงานที่เกี่ยวข้องกับการขาย เช่น
การ Confirm Sale Order, การสร้าง Invoice จาก Sale Order และการ Validate Invoice ของ Sale Order เป็นต้น
โดยกระบวนการการดำเนินงานโดยอัตโนมัติที่เกี่ยวข้องกับการขาย สามารถทำงานได้ใช้โมดูล
sale_automatic_workflow และ sale_automatic_workflow_job ของ OCA</p>
<p>โมดูล sale_automatic_workflow เป็นโมดูลที่ใช้ในการสร้างและตั้งค่าการทำงานของ Automatic Workflow
ที่จะนำมาใช้ในกระบวนการขาย ซึ่งเหมาะสำหรับระบบที่มีการทำงานโดยการ Interface ผ่าน API เข้ามาที่ Sale Order ใน Odoo</p>
<p>โมดูล sale_automatic_workflow_job เป็นโมดูลที่รวมการทำงานของ sale_automatic_workflow และ job_queue เข้าด้วยกัน
ทำให้ระบบสามารถจัดลำดับการทำงานของ Automatic Workflow ได้</p>
</div>
<div class="section" id="id9">
<h2>Configurations<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>การตั้งค่า Sale Automatic Workflow แบ่งออกเป็น 3 ส่วน ดังนี้</p>
<ol class="arabic simple">
<li><p>Order Configuration</p></li>
<li><p>Workflow Options</p></li>
<li><p>945 Workflow Options</p></li>
</ol>
<div class="section" id="order-configuration">
<h3>Order Configuration<a class="headerlink" href="#order-configuration" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Shipping Policy</strong> คือ วิธีการจัดส่งสินค้า ซึ่งแบ่งได้ดังนี้</dt><dd><ul>
<li><p>Deliver all products at once คือ ส่งสินค้าทั้งหมดที่ลูกค้าต้องการในครั้งเดียว</p></li>
<li><p>Deliver each product when available คือ ส่งสินค้าเท่าที่มีในคลัง(ตามที่ระบุในระบบ)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>Sales Team</strong> คือ ทีมที่ขายสินค้าได้</p></li>
</ul>
</div>
<div class="section" id="workflow-options">
<h3>Workflow Options<a class="headerlink" href="#workflow-options" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Validate Order</strong> คือ ต้องการให้ Confirm Sale Oder หรือไม่ โดยสามารถจำกัด Domain ของ Sale Order ที่ต้องการ Confirm ได้ที่ <strong>Order Filter</strong></p></li>
<li><p><strong>Confirm and Transfer Picking</strong> คือ ต้องการให้ส่งของและ Validate Delivery Order หรือไม่</p></li>
<li><p><strong>Create Invoice</strong> คือ ต้องการให้สร้าง Invoice หรือไม่ โดยสามารถจำกัด Domain ของ Sale Order ที่ต้องการสร้าง Invoice ได้ที่ <strong>Create Invoice Filter</strong></p></li>
<li><p><strong>Validate Invoice</strong> คือ ต้องการให้ Validate Invoice หรือไม่ โดยสามารถจำกัด Domain ของ Sale Order ที่ต้องการ Validate ได้ที่ <strong>Validate Invoice Filter</strong></p></li>
<li><p><strong>Sale Done</strong> คือ ต้องการ Locked Sale Order หลังจาก Confirm Sale Oder หรือไม่</p></li>
<li><p><strong>Force Invoice Date</strong> คือ ต้องการให้ Invoice Date ใน Invoice เป็นวันเดียวกับ Order Date ใน Sale Order หรือไม่</p></li>
<li><p><strong>Invoice Service on delivery</strong> คือ ต้องการให้บันทึกจำนวน Deliveried ของสินค้าประเภทบริการใน Sale Order หลังจากสร้าง Invoice หรือไม่</p></li>
<li><p><strong>Sales Journal</strong> คือ Journal ที่จะใช้ใน Invoice</p></li>
<li><p><strong>Warning Message</strong> คือ ข้อความที่จะขึ้นแจ้งเตือน เมื่อเลือก Automatic Workflow นี้ ใน Sale Order</p></li>
</ul>
</div>
<div class="section" id="id10">
<h3>945 Workflow Options<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Allow Compute Sale Order Line</strong> คือ ต้องการให้คำนวณรายได้อื่นๆ เช่น รายได้ค่าขนส่ง ใน Sale Order หรือไม่</p></li>
<li><p><strong>Record Transportation Cost</strong> คือ ต้องการสร้าง Transportation Cost (TC) หรือไม่</p></li>
<li><p><strong>Record Delivery Complete</strong> คือ ต้องการสร้าง Delivery Complete (DC) หรือไม่</p></li>
<li><dl class="simple">
<dt><strong>Consignment Payable</strong> คือ วิธีการคำนวณเจ้าหนี้การค้าฝากขาย ซึ่งจะเท่ากับ Account Payable Transfer (APT) โดยสามารถเลือกได้ ดังนี้</dt><dd><ul>
<li><p>None คือ ไม่คำนวณ Consignment Payable</p></li>
<li><p>Fixed Cost คือ คำนวณโดยที่ทราบต้นทุนที่แน่นอน เช่น เมื่อขายสินค้า A ได้ จะต้องจ่ายเงินให้ผู้ฝากขาย 10 บาท/หน่วย</p></li>
<li><p>Variance Cost คือ คำนวณโดยที่ไม่ทราบต้นทุนที่แน่นอน เช่น เมื่อขายสินค้า B ได้ ผู้ฝากขายจะได้รับเงินตามรายได้หลังหักค่าใช้จ่ายต่างๆแล้ว</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="s-configurations">
<h2>945’s Configurations<a class="headerlink" href="#s-configurations" title="Permalink to this headline">¶</a></h2>
<p>ปัจจุบัน 945 มีการใช้ Sale Automatic Workflow ทั้งหมด 4 แบบ ดังนี้</p>
<ol class="arabic simple">
<li><p>eCommerce Standard</p></li>
<li><p>eCommerce Consignment Fix GP</p></li>
<li><p>eCommerce Consignment Var GP</p></li>
<li><p>Express Standard</p></li>
</ol>
<div class="section" id="id11">
<h3>eCommerce Standard<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/automatic_workflow_ecom_std.png" class="align-center" src="../_images/automatic_workflow_ecom_std.png" />
</div>
<div class="section" id="id12">
<h3>eCommerce Consignment Fix GP<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/automatic_workflow_ecom_consign_fix.png" class="align-center" src="../_images/automatic_workflow_ecom_consign_fix.png" />
</div>
<div class="section" id="id13">
<h3>eCommerce Consignment Var GP<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/automatic_workflow_ecom_consign_var.png" class="align-center" src="../_images/automatic_workflow_ecom_consign_var.png" />
</div>
<div class="section" id="id14">
<h3>Express Standard<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/automatic_workflow_express_std.png" class="align-center" src="../_images/automatic_workflow_express_std.png" />
</div>
</div>
</div>
<div class="section" id="account-move-template">
<span id="id15"></span><h1>&gt; Account Move Template<a class="headerlink" href="#account-move-template" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id16">
<h2>Account Move Template คืออะไร<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<p><strong>Menu:</strong> Accounting &gt; Configuration &gt; Accounting &gt; Journal Entry Templates</p>
<p>Account Move Template หรือ Journal Entry Template คือ Template ของการบันทึกบัญชี
มีประโยชน์ในการบันทึกบัญชีที่มีรูปแบบของคู่บัญชีเหมือนๆกัน แต่มีจำนวนมาก</p>
</div>
<div class="section" id="id17">
<h2>Configurations<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/account_move_template.png" class="align-center" src="../_images/account_move_template.png" />
<ul class="simple">
<li><p><strong>Name</strong> คือ ชื่อของ Template</p></li>
<li><p><strong>Journal</strong> คือ สมุดบัญชี</p></li>
<li><p><strong>Reference</strong> คือ ข้อความที่ต้องการให้แสดงใน Reference ของ Journal Entry</p></li>
</ul>
<img alt="../_images/account_move_template_line.png" class="align-center" src="../_images/account_move_template_line.png" />
<ul class="simple">
<li><p><strong>Sequence</strong> คือ ลำดับของ line และใช้อ้างอิงในการคำนวณด้วย</p></li>
<li><p><strong>Label</strong> คือ ข้อความที่ใช้อธิบายการบันทึกบัญชีของ line นั้นๆ</p></li>
<li><p><strong>Account</strong> คือ บัญชีที่ต้องการบันทึก</p></li>
<li><p><strong>Account Opt.</strong> คือ บัญชีที่ต้องการบันทึก เมื่อ Amount ติดลบ</p></li>
<li><p><strong>Partner</strong> คือ คู่ค้า</p></li>
<li><p><strong>Payment Terms</strong> คือ ระยะเวลาที่กำหนดในการจ่ายเงิน</p></li>
</ul>
<p>Amount</p>
<ul class="simple">
<li><p><strong>Direction</strong> คือ ทิศทางในการบันทึกบัญชี ได้แก่ Credit และ Debit</p></li>
<li><p><strong>Type</strong> คือ วิธีการรับข้อมูล Amount มี 2 แบบ คือ Computed และ User Input</p></li>
<li><p><strong>Note</strong> คือ ข้อความที่ต้องการบันทึกเพิ่มเติม</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Compute Formula คือ ส่วนที่ไว้ใส่สูตรที่ใช้ในการคำนวณ Amount ของ line นั้น จะปรากฏเมื่อเลือก <strong>Type</strong> เป็น Computed</p>
</div>
<p>Taxes</p>
<ul class="simple">
<li><p><strong>Is a refund?</strong> คือ เป็นการคืนเงินหรือไม่</p></li>
<li><p><strong>Originator Tax</strong> คือ ภาษีตั้งต้น</p></li>
<li><p><strong>Taxes</strong> คือ ภาษี</p></li>
</ul>
<p><strong>ตัวอย่าง Account Move Template</strong></p>
<img alt="../_images/deferred_revenue_template.png" class="align-center" src="../_images/deferred_revenue_template.png" />
</div>
<div class="section" id="id18">
<h2>วิธีใช้ Account Move Template<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<div class="section" id="code">
<h3>1. เรียกใช้งานผ่าน Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<p>สิ่งที่จำเป็นในการเรียกใช้งาน Account Move Template คือ</p>
<ol class="arabic simple">
<li><p>สร้าง Record ของ <cite>account.move.template.run</cite></p></li>
<li><p>เรียกใช้ function <cite>generate_move()</cite></p></li>
</ol>
<p>ตัวอย่างการเรียกใช้งานผ่าน Code</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_generate_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">wiz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_move</span><span class="p">()</span>
    <span class="n">wizard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">wiz</span><span class="p">[</span><span class="s2">&quot;res_model&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">wiz</span><span class="p">[</span><span class="s2">&quot;res_id&quot;</span><span class="p">])</span>
    <span class="n">wizard</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">wiz</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">generate_move</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="ui">
<h3>2. เรียกใช้งานผ่าน UI<a class="headerlink" href="#ui" title="Permalink to this headline">¶</a></h3>
<p><strong>วิธีที่ 1</strong></p>
<img alt="../_images/gen_move_1.gif" class="align-center" src="../_images/gen_move_1.gif" />
<ol class="arabic simple">
<li><p>เข้าไปที่ Accounting &gt; Accounting &gt; Miscellaneous &gt; Create Entry from Template</p></li>
<li><p>เลือก Template ที่ต้องการใช้เป็นแบบในการบันทึกบัญชี</p></li>
<li><p>ใส่ข้อมูลที่ต้องการให้แสดงใน Journal Entry</p></li>
<li><p>หลังจากใส่ข้อมูลและตรวจสอบข้อมูลเรียบร้อยแล้ว ให้กดที่ปุ่ม <strong>CREATE JOURNAL ENTRY</strong> เพื่อสร้าง Journal Entry</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>สามารถ overwrite ข้อมูลใน line ที่เราต้องการได้ โดยการเพิ่มข้อมูลที่ต้องการ overwrite ไปที่ฟิลด์ <strong>Overwrite</strong>
ในรูปแบบของ Dictionary เช่น <cite>{“L0”: {“partner_id”: 1, “date_maturity”: “2020-02-02”}}</cite></p>
</div>
<p><strong>วิธีที่ 2</strong></p>
<img alt="../_images/gen_move_2.gif" class="align-center" src="../_images/gen_move_2.gif" />
<ol class="arabic simple">
<li><p>เข้าไปที่ Accounting &gt; Configuration &gt; Accounting &gt; Journal Entry Templates</p></li>
<li><p>เลือก Template ที่ต้องการใช้เป็นแบบในการบันทึกบัญชี</p></li>
<li><p>กดที่ปุ่ม <strong>GENERATE JOURNAL ENTRY</strong></p></li>
<li><p>ใส่ข้อมูลที่ต้องการให้แสดงใน Journal Entry</p></li>
<li><p>หลังจากใส่ข้อมูลและตรวจสอบข้อมูลเรียบร้อยแล้ว ให้กดที่ปุ่ม <strong>CREATE JOURNAL ENTRY</strong> เพื่อสร้าง Journal Entry</p></li>
</ol>
</div>
</div>
</div>
<div class="section" id="compute-helper">
<span id="id19"></span><h1>&gt; Compute helper<a class="headerlink" href="#compute-helper" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id20">
<h2>Compute Helper คืออะไร<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<p><strong>Menu:</strong> 945 &gt; Configurations &gt; Compute &gt; Compute Type / Helper</p>
<p>Compute Helper เกิดขึ้นเนื่องจากการคำนวนเพื่อให้ได้ค่าต่างๆที่เกิดขึ้นในระบบเช่น Service Cost ซึ่งหลังจากที่เราพัฒนาระบบไปได้ซักระยะ
พบว่าระบบมีความซับซ้อนเพราะสูตรการคำนวนขึ้นอยู่กับหลายตัวแปร เช่น Partner, Product, Payment Method การฝังกฏการคำนวนไว้ในโค้ด (hard code)
จะทำให้การดูแลระบบเป็นไปอย่างยากลำบาก</p>
<p>จึงได้มีการสร้างตาราง Mapping ไว้แยกต่างหาก (Compute Helper) เพื่อให้เห็นว่าในแต่ละประเภทของการคำนวน (Compute Type)
มีสูตรการคำนวน (Server Action) อย่างไร</p>
<p>ตัวอย่างตามรูปคือตัวช่วยการคำนวนสำหรับฟังก์ชั่น _get_service_cost()</p>
<img alt="../_images/compute_helper.png" class="align-center" src="../_images/compute_helper.png" />
<p>ตัวอย่างสำหรับ _get_service_cost() จะถูกเรียกใช้งานผ่าน compute helper ตามตัวอย่างด้านล่าง</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_get_service_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payment_method_id</span><span class="p">,</span> <span class="n">payment_provider_id</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;sunteen.compute.helper&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_get_service_cost&quot;</span><span class="p">,</span> <span class="n">partner_id</span><span class="o">=</span><span class="n">payment_provider_id</span><span class="o">.</span><span class="n">id</span> <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">payment_method_id</span><span class="o">=</span><span class="n">payment_method_id</span><span class="o">.</span><span class="n">id</span> <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span> <span class="n">input_dict</span><span class="o">=</span><span class="p">{}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<dl class="simple">
<dt>Compute Helper ทั้งหมดปัจจุบันจะถูกโหลดเข้าระบบด้วยไฟล์ data จาก</dt><dd><ul class="simple">
<li><p>sunteen/data/sunteen_compute_helper_data.xml</p></li>
<li><p>sunteen_data/data/sunteen.compute.helper.csv</p></li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="server-actions">
<h2>Server Actions<a class="headerlink" href="#server-actions" title="Permalink to this headline">¶</a></h2>
<p><strong>Menu:</strong> Settings &gt; Technical &gt; Actions &gt; Server Actions</p>
<p>ด้วย Compute Helper จะมาเรียก Server Action ต่อ แล้ว Server Action คืออะไร?</p>
<p>Server Action เป็นฟังก์ชั่นมาตรฐานหนึ่งของ Odoo ใช้สำหรับการเขียน scriptlet ด้วย Python สั้นๆได้ โดยใน scriptlet
สามารถรับการผ่านค่าต่างๆผ่านตัวแปร Context (เช่น model, active_id และอื่นๆ) โดยหลังจากที่สร้าง scriptlet นี้แล้วสามารถนำมันไปผูกใช้งาน
กับโมเดลที่สนใจได้ ในกรณีของ 945 เราสร้าง scriptlet โดยไม่ได้นำไปผูกกับโมเดลใดๆ แต่เรียกใช้โดยตรงผ่านฟัังชั่นดังตัวอย่าง _get_service_cost()</p>
<p>รูปนี้เป็นตัวอย่างการเขียน Server Action ที่ใช้ในการคำนวน Service Cost</p>
<img alt="../_images/server_action.png" class="align-center" src="../_images/server_action.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>รายละเอียดเพิ่มเติมเกี่ยวกับ <a class="reference external" href="https://www.odoo.com/documentation/14.0/reference/actions.html#server-actions-ir-actions-server">Server Action</a></p>
</div>
</div>
</div>
<div class="section" id="unit-test">
<span id="id21"></span><h1>&gt; Unit Test<a class="headerlink" href="#unit-test" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-unit-test">
<h2>What is unit test?<a class="headerlink" href="#what-is-unit-test" title="Permalink to this headline">¶</a></h2>
<p>Unit Test คือ script ในการจำลองให้ระบบทำงานผ่านโค้ด มีประโยชน์ในการตรวจสอบระบบที่มีการแก้ไขต่อเนื่องให้แน่ใจว่าสิ่งที่แก้ไม่ไปขัดแย้งกับส่วนเดิม
หรือถ้าแย้งกันเราจะได้รู้ว่าระบบทำงานถูกต้องหรือไม่ หรือต้องปรับโค้ดและ test script ให้ถูกต้อง</p>
<p>ในระบบ 945 เรามีการเขียน Unit Test เฉพาะกับการทำงานกับ API และซึ่งมีการบันทึกบัญชีอัตโนมัติ
โดยปกติเราจะรัน unit test บน development machine เท่านั้นเพื่อตรวจสอบการทำงานของโค้ดก่อนการ deploy</p>
<p>Test script จะถูกเก็บไว้ที่โมดูล sunteen_test โดยเมื่อจะรัน test สิ่งที่ต้องทำคือการ start Odoo ผ่าน Command Line
ด้วย -d &lt;database&gt; -i sunteen_test –test-enable เช่น</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">odoo</span><span class="o">-</span><span class="nb">bin</span> <span class="o">-</span><span class="n">c</span> <span class="n">odoo</span><span class="o">.</span><span class="n">conf</span> <span class="o">-</span><span class="n">d</span> <span class="n">api_odoo</span> <span class="o">-</span><span class="n">i</span> <span class="n">sunteen_test</span> <span class="o">--</span><span class="n">test</span><span class="o">-</span><span class="n">enable</span>
</pre></div>
</div>
<p>คำสั่งนี้จะบอกให้ Odoo ทำงานกับ database api_odoo และทำการรันการทดสอบของโมดูล sunteen_test</p>
<p>โดย log ของ command line จะมีผลดังตัวอย่างนี้หากสำเร็จ</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">19</span> <span class="mi">05</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span><span class="mi">837</span> <span class="mi">23016</span> <span class="n">INFO</span> <span class="n">sunteen</span> <span class="n">odoo</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">sunteen_test</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">test_ecom_standard_1</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">TestEcomStandard</span><span class="o">.</span><span class="n">test_2_transportation_cost</span> <span class="o">...</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">19</span> <span class="mi">05</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span><span class="mi">958</span> <span class="mi">23016</span> <span class="n">WARNING</span> <span class="n">sunteen</span> <span class="n">odoo</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">res_company</span><span class="p">:</span> <span class="n">The</span> <span class="n">method</span> <span class="s1">&#39;_company_default_get&#39;</span> <span class="n">on</span> <span class="n">res</span><span class="o">.</span><span class="n">company</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">shouldn</span><span class="s1">&#39;t be used anymore</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">19</span> <span class="mi">05</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">428</span> <span class="mi">23016</span> <span class="n">INFO</span> <span class="n">sunteen</span> <span class="n">odoo</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">sunteen_test</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">test_ecom_standard_1</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">TestEcomStandard</span><span class="o">.</span><span class="n">test_3_invoice_entry</span> <span class="o">...</span>
<span class="hll"> <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">19</span> <span class="mi">05</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span><span class="mi">432</span> <span class="mi">23016</span> <span class="n">INFO</span> <span class="n">sunteen</span> <span class="n">odoo</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="p">:</span> <span class="n">Ran</span> <span class="mi">3</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">1.024</span><span class="n">s</span>
</span></pre></div>
</div>
<p>และอาจมีผลลัพธ์แบบนี้หากไม่สำเร็จ</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">19</span> <span class="mi">04</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="mi">697</span> <span class="mi">21813</span> <span class="n">INFO</span> <span class="n">sunteen</span> <span class="n">odoo</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">sunteen_test</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">test_ecom_standard_1</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">TestEcomStandard</span><span class="o">.</span><span class="n">test_4_delivery_complete</span> <span class="o">...</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">19</span> <span class="mi">04</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="mi">698</span> <span class="mi">21813</span> <span class="n">INFO</span> <span class="n">sunteen</span> <span class="n">odoo</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">sunteen_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">utils</span><span class="p">:</span> <span class="p">[</span><span class="n">sunteen</span><span class="o">.</span><span class="n">delivery</span><span class="o">.</span><span class="n">complete</span><span class="p">]</span><span class="o">.</span><span class="n">create_data</span><span class="p">(),</span> <span class="nb">input</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;out for delivery&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="mi">4960</span><span class="p">,</span> <span class="s1">&#39;sunteen_dealer_id&#39;</span><span class="p">:</span> <span class="mi">4961</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;55-CP20053042686x&#39;</span><span class="p">,</span> <span class="s1">&#39;workflow_process_id&#39;</span><span class="p">:</span> <span class="s1">&#39;eCommerce Standard&#39;</span><span class="p">,</span> <span class="s1">&#39;date_order&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-06-01&#39;</span><span class="p">,</span> <span class="s1">&#39;transation_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-06-01&#39;</span><span class="p">,</span> <span class="s1">&#39;sunteen_payment_method_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sunteen_payment_provider_id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">3200.0</span><span class="p">,</span> <span class="s1">&#39;order_line&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;product_id&#39;</span><span class="p">:</span> <span class="mi">1323</span><span class="p">,</span> <span class="s1">&#39;product_uom_qty&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;dealer_price_unit&#39;</span><span class="p">:</span> <span class="mf">1600.0</span><span class="p">,</span> <span class="s1">&#39;sunteen_parcel_number&#39;</span><span class="p">:</span> <span class="s1">&#39;TDZ20982676x&#39;</span><span class="p">,</span> <span class="s1">&#39;sunteen_partner_id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;sunteen_customer&#39;</span><span class="p">:</span> <span class="s1">&#39;คันธรส จงอร่ามเรือง(Kantarost)&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Colla Tab 10 กระปุก&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;product_id&#39;</span><span class="p">:</span> <span class="mi">1324</span><span class="p">,</span> <span class="s1">&#39;product_uom_qty&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;dealer_price_unit&#39;</span><span class="p">:</span> <span class="mf">1600.0</span><span class="p">,</span> <span class="s1">&#39;sunteen_parcel_number&#39;</span><span class="p">:</span> <span class="s1">&#39;TDZ20982676x&#39;</span><span class="p">,</span> <span class="s1">&#39;sunteen_partner_id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;sunteen_customer&#39;</span><span class="p">:</span> <span class="s1">&#39;คันธรส จงอร่ามเรือง(Kantarost)&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Aqua S คอลลาเจน 10 แพ็ค&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;product_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;product_uom_qty&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;dealer_price_unit&#39;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span> <span class="s1">&#39;sunteen_parcel_number&#39;</span><span class="p">:</span> <span class="s1">&#39;TDZ20982676x&#39;</span><span class="p">,</span> <span class="s1">&#39;sunteen_partner_id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;sunteen_customer&#39;</span><span class="p">:</span> <span class="s1">&#39;sudtinee jaithip&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Dealer Amount Difference&#39;</span><span class="p">}]},</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">}</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">19</span> <span class="mi">04</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="mi">701</span> <span class="mi">21813</span> <span class="n">INFO</span> <span class="n">sunteen</span> <span class="n">odoo</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">sunteen_test</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">test_ecom_standard_1</span><span class="p">:</span> <span class="o">======================================================================</span>
 <span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">19</span> <span class="mi">04</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="mi">701</span> <span class="mi">21813</span> <span class="n">ERROR</span> <span class="n">sunteen</span> <span class="n">odoo</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">sunteen_test</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">test_ecom_standard_1</span><span class="p">:</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">TestEcomStandard</span><span class="o">.</span><span class="n">test_4_delivery_complete</span>
 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
   <span class="n">File</span> <span class="s2">&quot;/home/kittiu/PycharmProjects/odoo-945-erp/sunteen_test/tests/test_ecom_standard_1.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">131</span><span class="p">,</span> <span class="ow">in</span> <span class="n">test_4_delivery_complete</span>
     <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DC</span><span class="o">.</span><span class="n">create_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ecom_standard_api2_data</span><span class="p">)</span>
 <span class="o">...</span>
<span class="hll"> <span class="ne">ValueError</span><span class="p">:</span> <span class="n">Wrong</span> <span class="n">value</span> <span class="k">for</span> <span class="n">sunteen</span><span class="o">.</span><span class="n">delivery</span><span class="o">.</span><span class="n">complete</span><span class="o">.</span><span class="n">delivery_status</span><span class="p">:</span> <span class="s1">&#39;out for delivery&#39;</span>
</span></pre></div>
</div>
</div>
<div class="section" id="id22">
<h2>การเขียน Unit Test<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<p>การเขียน Unit Test มีหลักการคือให้มองการทำงานเป็น blackbox เราจะใส่ input data เรียกการทำงาน และประเมินผลที่ได้
และเป้าหมายคือพยายามเขียน script ให้รันผ่านโค้ดให้มากที่สุด โดยเมื่อมีการ start Odoo ด้วย –test-enable
ระบบจะเข้าไปหาโฟลเดอร์ tests และไฟล์ที่ชื่อเริ่มต้นด้วย test_xxx.py และจะไปรัน method ที่เริ่มต้นด้วย def test_yyy()</p>
<img alt="../_images/unit_test.png" class="align-center" src="../_images/unit_test.png" />
<ol class="arabic simple">
<li><p>ระบบจะมองหาโฟลเดอร์ tests และหารไฟล์ที่เริ่มด้วย test_xxx.py</p></li>
<li><p>Inherit Test Class</p></li>
<li><p>Setup() คือส่วนที่เอาไว้ initialize ข้อมูลที่ต้องการใช้สำหรับแต่ละการทดสอบ</p></li>
<li><p>Test Cases, 1, 2, 3, 4… แล้วแต่เรื่องที่ต้องการ</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>รายละเอียดเพิ่มเติมเกี่ยวกับ <a class="reference external" href="https://www.odoo.com/documentation/14.0/reference/testing.html">Unit Testing</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../functional/th_tax_report.html" class="btn btn-neutral float-left" title="&gt; Thai Tax Report" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, 945 Team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>